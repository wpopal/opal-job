!function(s){"use strict";var o={init:function(){o.submitForm(),o.favorite(),o.followEmployer(),o.applyJob(),o.sendMessage(),o.submitJob()},makeAjax:function(e,t,i,o){var a={url:opaljobJS.ajaxurl,data:e,type:"POST",dataType:"json",success:function(e){if(1==e.status){if(e.redirect)setTimeout(function(){window.location.href=e.redirect},3e3);i(e);s.toast({heading:e.heading,text:e.message,icon:"success",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"});r.toggleSubmit(t)}else{r.toggleSubmit(t);s.toast({heading:e.heading,text:e.message,icon:"error",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"})}}};1==o&&(a.processData=!1,a.contentType=!1),r.toggleSubmit(t),s.ajax(a)},submitJob:function(){s(".opaljob-submited-form").on("submit",function(){var n=new FormData;n.append("section","general"),s(".opaljob-uploader-files",this).each(function(){s("input.select-file",this);var e=s(".uploader-item-preview",this),o=s(this).data("name"),a=s(this).data("single");s(e).each(function(e,t){var i=s(this).prop("file");i&&(a?n.append(o,i):n.append(o+"["+e+"]",i))})});var e=s(this).serializeArray();return s.each(e,function(e,t){n.append(t.name,t.value)}),n.append("action","opaljob_submitted_job_data"),o.makeAjax(n,s(":submit",this),function(e){},!0),!1})},sendMessage:function(){s(".opaljob-message-form").on("submit",function(){var e=s(this).serialize()+"&action=opaljob_send_email_contact";return o.makeAjax(e,s(":submit",this),function(){}),!1})},toggleSubmit:function(e){"disabled"==s(e).attr("disabled")?(s(e).removeAttr("disabled"),s(e).find("i").remove()):(s(e).attr("disabled","disabled"),s(e).append(' <i class="fa fa-spinner fa-spin"></i> '))},applyJob:function(){s("body").delegate(".job-apply-now","click",function(){s(this);if(!s(this).hasClass("opaljob-need-login"))return s("#opaljob-apply-form-popup")&&s.magnificPopup.open({items:{src:"#opaljob-apply-form-popup"},closeOnBgClick:!1,mainClass:"mfp-with-zoom",zoom:{enabled:!0}}),!1}),s(".opaljob-apply-job-form").submit(function(){var n=new FormData;n.append("section","general"),s(".opaljob-uploader-files",this).each(function(){s("input.select-file",this);var e=s(".uploader-item-preview",this),o=s(this).data("name"),a=s(this).data("single");s(e).each(function(e,t){var i=s(this).prop("file");i&&(a?n.append(o,i):n.append(o+"["+e+"]",i))})});var e=s(this).serializeArray();return s.each(e,function(e,t){n.append(t.name,t.value)}),n.append("action","opaljob_apply_job_data"),o.makeAjax(n,s(":submit",this),function(e){},!0),!1})},followEmployer:function(){s("body").delegate(".job-following-button","click",function(){var t=s(this);if(!s(this).hasClass("opaljob-need-login")){var e="employer_id="+s(this).data("employer-id")+"&action=opaljob_following_employer";o.makeAjax(e,s(this),function(e){e.html&&t.replaceWith(s(e.html))});var i=s(t).parent().parent();return i.hasClass("has-toggle-remove")&&i.remove(),!1}})},favorite:function(){s("body").delegate(".job-toggle-favorite","click",function(){var t=s(this);if(!s(this).hasClass("opaljob-need-login")){var e="job_id="+s(this).data("job-id")+"&action=opaljob_toggle_status";o.makeAjax(e,s(this),function(e){e.html&&t.replaceWith(s(e.html))})}}),s("body").delegate(".job-remove-favorite","click",function(){var e="job_id="+s(this).data("job-id")+"&action=opaljob_toggle_status",t=s(this);return o.makeAjax(e,s(this),function(e){s(t).parent().parent().remove(),e.html&&t.replaceWith(s(e.html))}),!1})},submitForm:function(){}};s(document).ready(function(){s(o.init)});var r={init:function(){r.changePassword()},makeAjax:function(e,t,i,o){var a=!0;1==o&&(a=!1),r.toggleSubmit(t),s.ajax({url:opaljobJS.ajaxurl,data:e,type:"POST",processData:a,contentType:a,dataType:"json",success:function(e){if(1==e.status){if(e.redirect)setTimeout(function(){window.location.href=e.redirect},3e3);i(e);s.toast({heading:e.heading,text:e.message,icon:"success",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"});r.toggleSubmit(t)}else{r.toggleSubmit(t);s.toast({heading:e.heading,text:e.message,icon:"error",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"})}}})},toggleSubmit:function(e){"disabled"==s(e).attr("disabled")?(s(e).removeAttr("disabled"),s(e).find("i").remove()):(s(e).attr("disabled","disabled"),s(e).append(' <i class="fa fa-spinner fa-spin"></i> '))},metaboxForm:function(){s(".opaljob-submited-form").submit(function(){var n=new FormData;n.append("section","general"),s(".opaljob-uploader-files",this).each(function(){s("input.select-file",this);var e=s(".uploader-item-preview",this),o=s(this).data("name"),a=s(this).data("single");s(e).each(function(e,t){var i=s(this).prop("file");i&&(a?n.append(o,i):n.append(o+"["+e+"]",i))})});var e=s(this).serializeArray();s.each(e,function(e,t){n.append(t.name,t.value)}),n.append("action","opaljob_submitted_job_data"),r.makeAjax(n,s(":submit",this),function(e){},!0)})},changePassword:function(){s("#opaljob-changepassword-form").submit(function(){return r.makeAjax(s(this).serialize()+"&action=opaljob_save_changepass",s("button:submit",this)),!1})}};s(r.init);function e(e,t){!function(e,t){var i=e,o=i.icon,a=new google.maps.Size(42,57);1.5<window.devicePixelRatio&&i.retinaIcon&&(o=i.retinaIcon,a=new google.maps.Size(83,113));var n,s,r=new google.maps.LatLng(i.latitude,i.longitude),l={center:r,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},p=new google.maps.Map(document.getElementById(t),l);new google.maps.InfoWindow;n=r,s={url:o,size:a,scaledSize:new google.maps.Size(32,57),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(21,56)},new google.maps.Marker({map:p,position:n,icon:s})}(e,t)}var t={init:function(){t.trigger()},trigger:function(){s(".job-preview-map").each(function(){new e(s(this).data(),s(this).attr("id"))})}};s(document).ready(function(){s(t.init)});var i={init:function(){i.trigger()},trigger:function(){s("#opaljob-search-map-preview").length}};s(document).ready(function(){s(i.init)});var a={init:function(){a.trigger(),a.tabs()},tabs:function(){s(".opaljob-tab .tab-item").click(function(e){e.preventDefault(),s(this).parent().find(" .tab-item").removeClass("active"),s(this).addClass("active"),s(s(this).attr("href")).parent().children(".opaljob-tab-content").removeClass("active"),s(s(this).attr("href")).addClass("active")}),s(".opaljob-tab").each(function(){s(this).find(".tab-item").first().click()})},trigger:function(){s("body").delegate(".opaljob-popup-button","click",function(){var e=s(this).data("target");return s.magnificPopup.open({items:{src:e}}),!1}),s(document).on("opaljob:login",function(){s("#opaljob-user-form-popup")&&s.magnificPopup.open({items:{src:"#opaljob-user-form-popup"},mainClass:"mfp-with-zoom",zoom:{enabled:!0}})}),s("body").delegate(".opaljob-need-login","click",function(){s(document).trigger("opaljob:login",[!0]);s.toast({heading:"User login",text:"Please login the site to complete the action.",icon:"warning",position:"bottom-right",hideAfter:5e3,showHideTransition:"fade"});return!1})}};s(document).ready(function(){s(a.init)})}(jQuery);