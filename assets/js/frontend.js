!function(j){"use strict";var a={init:function(){a.submitForm(),a.favorite(),a.followEmployer(),a.applyJob(),a.sendMessage(),a.submitJob()},makeAjax:function(e,o,t,a){var i={url:opaljobJS.ajaxurl,data:e,type:"POST",dataType:"json",success:function(e){if(1==e.status){if(e.redirect)setTimeout(function(){window.location.href=e.redirect},3e3);t(e);j.toast({heading:e.heading,text:e.message,icon:"success",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"});s.toggleSubmit(o)}else{s.toggleSubmit(o);j.toast({heading:e.heading,text:e.message,icon:"error",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"})}}};1==a&&(i.processData=!1,i.contentType=!1),s.toggleSubmit(o),j.ajax(i)},submitJob:function(){j(".opaljob-submited-form").on("submit",function(){var n=new FormData;n.append("section","general"),j(".opaljob-uploader-files",this).each(function(){j("input.select-file",this);var e=j(".uploader-item-preview",this),a=j(this).data("name"),i=j(this).data("single");j(e).each(function(e,o){var t=j(this).prop("file");t&&(i?n.append(a,t):n.append(a+"["+e+"]",t))})});var e=j(this).serializeArray();return j.each(e,function(e,o){n.append(o.name,o.value)}),n.append("action","opaljob_submitted_job_data"),a.makeAjax(n,j(":submit",this),function(e){},!0),!1})},sendMessage:function(){j(".opaljob-message-form").on("submit",function(){var e=j(this).serialize()+"&action=opaljob_send_email_contact";return a.makeAjax(e,j(":submit",this),function(){}),!1})},toggleSubmit:function(e){"disabled"==j(e).attr("disabled")?(j(e).removeAttr("disabled"),j(e).find("i").remove()):(j(e).attr("disabled","disabled"),j(e).append(' <i class="fa fa-spinner fa-spin"></i> '))},applyJob:function(){j("body").delegate(".job-apply-now","click",function(){j(this);if(!j(this).hasClass("opaljob-need-login"))return j("#opaljob-apply-form-popup")&&j.magnificPopup.open({items:{src:"#opaljob-apply-form-popup"},closeOnBgClick:!1,mainClass:"mfp-with-zoom",zoom:{enabled:!0}}),!1}),j(".opaljob-apply-job-form").submit(function(){var n=new FormData;n.append("section","general"),j(".opaljob-uploader-files",this).each(function(){j("input.select-file",this);var e=j(".uploader-item-preview",this),a=j(this).data("name"),i=j(this).data("single");j(e).each(function(e,o){var t=j(this).prop("file");t&&(i?n.append(a,t):n.append(a+"["+e+"]",t))})});var e=j(this).serializeArray();return j.each(e,function(e,o){n.append(o.name,o.value)}),n.append("action","opaljob_apply_job_data"),a.makeAjax(n,j(":submit",this),function(e){},!0),!1})},followEmployer:function(){j("body").delegate(".job-following-button","click",function(){var o=j(this);if(!j(this).hasClass("opaljob-need-login")){var e="employer_id="+j(this).data("employer-id")+"&action=opaljob_following_employer";a.makeAjax(e,j(this),function(e){e.html&&o.replaceWith(j(e.html))});var t=j(o).parent().parent();return t.hasClass("has-toggle-remove")&&t.remove(),!1}})},favorite:function(){j("body").delegate(".job-toggle-favorite","click",function(){var o=j(this);if(!j(this).hasClass("opaljob-need-login")){var e="job_id="+j(this).data("job-id")+"&action=opaljob_toggle_status";a.makeAjax(e,j(this),function(e){e.html&&o.replaceWith(j(e.html))})}}),j("body").delegate(".job-remove-favorite","click",function(){var e="job_id="+j(this).data("job-id")+"&action=opaljob_toggle_status",o=j(this);return a.makeAjax(e,j(this),function(e){j(o).parent().parent().remove(),e.html&&o.replaceWith(j(e.html))}),!1})},submitForm:function(){}};j(document).ready(function(){j(a.init)});var s={init:function(){s.changePassword()},makeAjax:function(e,o,t,a){var i=!0;1==a&&(i=!1),s.toggleSubmit(o),j.ajax({url:opaljobJS.ajaxurl,data:e,type:"POST",processData:i,contentType:i,dataType:"json",success:function(e){if(1==e.status){if(e.redirect)setTimeout(function(){window.location.href=e.redirect},3e3);t(e);j.toast({heading:e.heading,text:e.message,icon:"success",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"});s.toggleSubmit(o)}else{s.toggleSubmit(o);j.toast({heading:e.heading,text:e.message,icon:"error",position:"bottom-right",hideAfter:4e3,showHideTransition:"fade"})}}})},toggleSubmit:function(e){"disabled"==j(e).attr("disabled")?(j(e).removeAttr("disabled"),j(e).find("i").remove()):(j(e).attr("disabled","disabled"),j(e).append(' <i class="fa fa-spinner fa-spin"></i> '))},metaboxForm:function(){j(".opaljob-submited-form").submit(function(){var n=new FormData;n.append("section","general"),j(".opaljob-uploader-files",this).each(function(){j("input.select-file",this);var e=j(".uploader-item-preview",this),a=j(this).data("name"),i=j(this).data("single");j(e).each(function(e,o){var t=j(this).prop("file");t&&(i?n.append(a,t):n.append(a+"["+e+"]",t))})});var e=j(this).serializeArray();j.each(e,function(e,o){n.append(o.name,o.value)}),n.append("action","opaljob_submitted_job_data"),s.makeAjax(n,j(":submit",this),function(e){},!0)})},changePassword:function(){j("#opaljob-changepassword-form").submit(function(){return s.makeAjax(j(this).serialize()+"&action=opaljob_save_changepass",j("button:submit",this)),!1})}};j(s.init);function e(e,o){!function(e,o){var t=e,a=t.icon,i=new google.maps.Size(42,57);1.5<window.devicePixelRatio&&t.retinaIcon&&(a=t.retinaIcon,i=new google.maps.Size(83,113));var n,s,r=new google.maps.LatLng(t.latitude,t.longitude),l={center:r,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},p=new google.maps.Map(document.getElementById(o),l);new google.maps.InfoWindow;n=r,s={url:a,size:i,scaledSize:new google.maps.Size(32,57),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(21,56)},new google.maps.Marker({map:p,position:n,icon:s})}(e,o)}var o={init:function(){o.trigger()},trigger:function(){j(".job-preview-map").each(function(){new e(j(this).data(),j(this).attr("id"))})}};j(document).ready(function(){j(o.init)});function t(e){!function(e){for(var o={zoom:12,maxZoom:16,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!0,overviewMapControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_TOP},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},p=new google.maps.Map(document.getElementById("opaljob-search-map-preview"),o),t=new google.maps.LatLngBounds,c=new Array,a=0;a<e.length;a++){var i=e[a].icon,n=new google.maps.Size(42,57);1.5<window.devicePixelRatio&&e[a].retinaIcon&&(i=e[a].retinaIcon,n=new google.maps.Size(83,113));var s={url:i,size:n,scaledSize:new google.maps.Size(30,51),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(21,56)};c[a]=new google.maps.Marker({position:new google.maps.LatLng(e[a].lat,e[a].lng),map:p,icon:s,title:e[a].title,animation:google.maps.Animation.DROP,visible:!0}),t.extend(c[a].getPosition());var r=document.createElement("div"),l="";e[a].pricelabel&&(l=" / "+e[a].pricelabel),r.className="map-info-preview media";var m='<ul class="list-inline job-meta-list">';if(e[a].metas)for(var d in e[a].metas){var u=e[a].metas[d];m+='<li><i class="icon-job-'+d+'"></i>'+u.value+'<span class="label-job">'+u.label+"</span></li>"}m+="</ul>",r.innerHTML='<div class="media-top"><a class="thumb-link" href="'+e[a].url+'"><img class="prop-thumb" src="'+e[a].thumb+'" alt="'+e[a].title+'"/></a>'+e[a].status+'</div><div class="info-container media-body"><h5 class="prop-title"><a class="title-link" href="'+e[a].url+'">'+e[a].title+'</a></h5><p class="prop-address"><em>'+e[a].address+'</em></p><p><span class="price text-primary">'+e[a].pricehtml+l+"</span></p>"+m+'</div><div class="arrow-down"></div>';var g={content:r,disableAutoPan:!0,maxWidth:0,alignBottom:!0,pixelOffset:new google.maps.Size(-122,-48),zIndex:null,closeBoxMargin:"0 0 -16px -16px",closeBoxURL:opaljobJS.mapiconurl+"close.png",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1},f=new InfoBox(g);v(p,c[a],f,a)}var h=null;j("body").delegate('[data-related="map"]',"mouseenter",function(){if(j(this).hasClass("map-active"))return!0;var e=j(this).data("id");if(j('[data-related="map"]').removeClass("map-active"),j(this).addClass("active"),p.setZoom(65536),c[e]){var o=c[e];google.maps.event.trigger(c[e],"click");var t=Math.pow(2,p.getZoom()),a=100/t||0,i=p.getProjection(),n=o.getPosition(),s=i.fromLatLngToPoint(n),r=new google.maps.Point(s.x,s.y-a),l=i.fromPointToLatLng(r);p.setZoom(t),p.setCenter(l)}return!1}),p.fitBounds(t);var b={ignoreHidden:!0,maxZoom:14,styles:[{textColor:"#000000",url:opaljobJS.mapiconurl+"cluster-icon.png",height:51,width:30}]};new MarkerClusterer(p,c,b);function v(r,l,p,c){google.maps.event.addListener(l,"click",function(){if(0<j('[data-related="map"]').filter('[data-id="'+c+'"]').length){var e=j('[data-related="map"]').filter('[data-id="'+c+'"]');j('[data-related="map"]').removeClass("map-active"),e.addClass("map-active")}null!=h&&h.close();var o=100/Math.pow(2,r.getZoom())||0,t=r.getProjection(),a=l.getPosition(),i=t.fromLatLngToPoint(a),n=new google.maps.Point(i.x,i.y-o),s=t.fromPointToLatLng(n);r.setCenter(s),p.open(r,l),h=p})}}(e)}var i={init:function(){i.trigger()},updatePreviewGoogleMap:function(e){j.ajax({type:"GET",dataType:"json",url:opaljobJS.ajaxurl,data:e,success:function(e){new t(e)}})},trigger:function(){if(0<j("#opaljob-search-map-preview").length){var a=function(e){if(0<j("#opaljob-search-map-preview").length){var o=location.search.substr(1)+"&action=opaljob_get_jobs_map&paged=0";e&&(o+="&"+e),i.updatePreviewGoogleMap(o)}};a(null),j("form.opaljob-form-search-jobs").submit(function(){var e=j(this).serialize();if(a(e),history.pushState){var o=j(this).serialize(),t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+o;window.history.pushState({path:t},"",t)}return!1}),j("form.opaljob-form-search-jobs .form-checkbox-control").change(function(){j("form.opaljob-form-search-jobs").submit()}),j("form.opaljob-form-search-jobs .form-control").change(function(){j("form.opaljob-form-search-jobs").submit()})}}};j(document).ready(function(){j(i.init)});var n={init:function(){n.trigger(),n.tabs()},tabs:function(){j(".opaljob-tab .tab-item").click(function(e){e.preventDefault(),j(this).parent().find(" .tab-item").removeClass("active"),j(this).addClass("active"),j(j(this).attr("href")).parent().children(".opaljob-tab-content").removeClass("active"),j(j(this).attr("href")).addClass("active")}),j(".opaljob-tab").each(function(){j(this).find(".tab-item").first().click()})},trigger:function(){j("body").delegate(".opaljob-popup-button","click",function(){var e=j(this).data("target");return j.magnificPopup.open({items:{src:e}}),!1}),j(document).on("opaljob:login",function(){j("#opaljob-user-form-popup")&&j.magnificPopup.open({items:{src:"#opaljob-user-form-popup"},mainClass:"mfp-with-zoom",zoom:{enabled:!0}})}),j("body").delegate(".opaljob-need-login","click",function(){j(document).trigger("opaljob:login",[!0]);j.toast({heading:"User login",text:"Please login the site to complete the action.",icon:"warning",position:"bottom-right",hideAfter:5e3,showHideTransition:"fade"});return!1})}};j(document).ready(function(){j(n.init)})}(jQuery);